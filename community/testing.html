

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Notes on test runners compatible with Qcodes &mdash; QCoDeS 0.1.3 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="QCoDeS 0.1.3 documentation" href="../index.html"/>
        <link rel="up" title="Community Guide" href="index.html"/>
        <link rel="next" title="Classes and Functions" href="../api/index.html"/>
        <link rel="prev" title="Object Hierarchy" href="objects.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> QCoDeS
          

          
          </a>

          
            
            
              <div class="version">
                0.1.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">Get Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Community Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install.html">Source Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="objects.html">Object Hierarchy</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Notes on test runners compatible with Qcodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Classes and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/generated/qcodes.instrument_drivers.html">qcodes.instrument_drivers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Qcodes project plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes/index.html">Changelogs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QCoDeS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Community Guide</a> &raquo;</li>
        
      <li>Notes on test runners compatible with Qcodes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/community/testing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="notes-on-test-runners-compatible-with-qcodes">
<span id="testing"></span><h1>Notes on test runners compatible with Qcodes<a class="headerlink" href="#notes-on-test-runners-compatible-with-qcodes" title="Permalink to this headline">Â¶</a></h1>
<p>There is now a test script <a class="reference external" href="qcodes/test.py">test.py</a> in the qcodes
directory that uses the standard <code class="docutils literal"><span class="pre">unittest</span></code> machinery to run all the
core tests (does not include instrument drivers). It has been tested on
Mac (terminal), and Windows (cmd, git bash, and PowerShell). It includes
coverage testing, but will only print a coverage report if tests pass.</p>
<p>The biggest difficulty with testing Qcodes is windows multiprocessing.
The spawn method restricts execution in ways that are annoying for
regular users (no class/function definitions in the notebook, no
closures) but seem to be completely incompatible with some test runners
(and/or coverage tracking)</p>
<p>I considered the following test runners: - <strong>nose</strong>: works well, but it
has a <a class="reference external" href="https://nose.readthedocs.org/en/latest/">note on its homepage</a>
that it is no longer being actively maintained (in favor of nose2
development), so we should not use it long-term.</p>
<ul class="simple">
<li><strong>unittest</strong>: the standard, built-in python tester. The only thing we
really need to add to this is coverage testing, so now the question
is what&#8217;s the easiest way to do this? On Windows just using unittest
wrapped in coverage fails.</li>
<li><strong>nose2</strong>: has a broken coverage plugin - it reports all the
unindented lines, ie everything # that executes on import, as
uncovered - but can be used by wrapping it inside coverage instead,
just like unittest.</li>
<li><strong>py.test</strong>: seems to add lots of features, but it&#8217;s not clear they
are useful for us? Has a good coverage plugin but seems to require
tons of command-line options. Requires both <code class="docutils literal"><span class="pre">pytest</span></code> and
<code class="docutils literal"><span class="pre">pytest-cov</span></code> packages</li>
</ul>
<p>on Mac terminal:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># the following work with coverage:</span>
<span class="n">nosetests</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">nosetests</span>
<span class="n">py</span><span class="o">.</span><span class="n">test</span> <span class="o">--</span><span class="n">cov</span><span class="o">-</span><span class="n">config</span> <span class="o">.</span><span class="n">coveragerc</span> <span class="o">--</span><span class="n">cov</span> <span class="n">qcodes</span> <span class="o">--</span><span class="n">cov</span><span class="o">-</span><span class="n">report</span> <span class="n">term</span><span class="o">-</span><span class="n">missing</span>
<span class="n">coverage</span> <span class="n">run</span> <span class="o">-</span><span class="n">m</span> <span class="n">nose2</span> <span class="o">&amp;&amp;</span> <span class="n">coverage</span> <span class="n">report</span> <span class="o">-</span><span class="n">m</span>
<span class="c1"># both of these run unittest:</span>
<span class="n">coverage</span> <span class="n">run</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span> <span class="o">&amp;&amp;</span> <span class="n">coverage</span> <span class="n">report</span> <span class="o">-</span><span class="n">m</span>
<span class="n">coverage</span> <span class="n">run</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="o">&amp;&amp;</span> <span class="n">coverage</span> <span class="n">report</span> <span class="o">-</span><span class="n">m</span>

<span class="c1"># nose2&#39;s coverage plugin is broken - it reports all the unindented lines (everything</span>
<span class="c1"># that executes on import) as uncovered</span>
<span class="n">nose2</span> <span class="o">-</span><span class="n">C</span> <span class="o">--</span><span class="n">coverage</span><span class="o">-</span><span class="n">report</span> <span class="n">term</span><span class="o">-</span><span class="n">missing</span>
</pre></div>
</div>
<p>Windows cmd shell and git bash behave identically, PowerShell has
different chain syntax (commands with &amp;&amp;):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># the following work with coverage:</span>
<span class="n">nosetests</span>
<span class="n">py</span><span class="o">.</span><span class="n">test</span> <span class="o">--</span><span class="n">cov</span><span class="o">-</span><span class="n">config</span> <span class="o">.</span><span class="n">coveragerc</span> <span class="o">--</span><span class="n">cov</span> <span class="n">qcodes</span> <span class="o">--</span><span class="n">cov</span><span class="o">-</span><span class="n">report</span> <span class="n">term</span><span class="o">-</span><span class="n">missing</span>
<span class="n">coverage</span> <span class="n">run</span> <span class="o">-</span><span class="n">m</span> <span class="n">nose2</span> <span class="o">&amp;&amp;</span> <span class="n">coverage</span> <span class="n">report</span> <span class="o">-</span><span class="n">m</span>  <span class="c1"># cmd or bash</span>
<span class="p">(</span><span class="n">coverage</span> <span class="n">run</span> <span class="o">-</span><span class="n">m</span> <span class="n">nose2</span><span class="p">)</span> <span class="o">-</span><span class="ow">and</span> <span class="p">(</span><span class="n">coverage</span> <span class="n">report</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span>  <span class="c1"># PowerShell</span>

<span class="c1"># the following work without coverage:</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">discover</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span>  <span class="c1"># discover is unnecessary now, perhaps because I put test_suite in setup.py?</span>

<span class="c1"># the following do not work:</span>

<span class="c1"># fails on relative import in unittest inside separate process (why is it importing that anyway?)</span>
<span class="n">coverage</span> <span class="n">run</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">discover</span> <span class="o">&amp;&amp;</span> <span class="n">coverage</span> <span class="n">report</span> <span class="o">-</span><span class="n">m</span>  <span class="c1"># cmd or bash</span>
<span class="p">(</span><span class="n">coverage</span> <span class="n">run</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">discover</span><span class="p">)</span> <span class="o">-</span><span class="ow">and</span> <span class="p">(</span><span class="n">coverage</span> <span class="n">report</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span>  <span class="c1"># PowerShell</span>
<span class="c1"># these fail asking for freeze_support() but nothing I do with that seems to help</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span>
<span class="n">coverage</span> <span class="n">run</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span> <span class="o">&amp;&amp;</span> <span class="n">coverage</span> <span class="n">report</span> <span class="o">-</span><span class="n">m</span>  <span class="c1"># cmd or bash</span>
<span class="p">(</span><span class="n">coverage</span> <span class="n">run</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">test</span><span class="p">)</span> <span class="o">-</span><span class="ow">and</span> <span class="p">(</span><span class="n">coverage</span> <span class="n">report</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span>  <span class="c1"># PowerShell</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">nosetests</span>
</pre></div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/index.html" class="btn btn-neutral float-right" title="Classes and Functions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="objects.html" class="btn btn-neutral" title="Object Hierarchy" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>