

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>qcodes.instrument.parameter &mdash; QCoDeS 0.1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="QCoDeS 0.1.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> QCoDeS
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">Classes and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../roadmap.html">Qcodes project plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes/index.html">Changelogs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">QCoDeS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>qcodes.instrument.parameter</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for qcodes.instrument.parameter</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Measured and/or controlled parameters</span>

<span class="sd">The Parameter class is meant for direct parameters of instruments (ie</span>
<span class="sd">subclasses of Instrument) but elsewhere in Qcodes we can use anything</span>
<span class="sd">as a parameter if it has the right attributes:</span>

<span class="sd">To use Parameters in data acquisition loops, they should have:</span>
<span class="sd">    .name - like a variable name, ie no spaces or weird characters</span>
<span class="sd">    .label - string to use as an axis label (optional, defaults to .name)</span>
<span class="sd">    (except for composite measurements, see below)</span>

<span class="sd">Controlled parameters should have a .set(value) method, which takes a single</span>
<span class="sd">value to apply to this parameter. To use this parameter for sweeping, also</span>
<span class="sd">connect its __getitem__ to SweepFixedValues as below.</span>

<span class="sd">Measured parameters should have .get() which can return:</span>

<span class="sd">- a single value:</span>
<span class="sd">    parameter should have .name and optional .label as above</span>

<span class="sd">- several values of different meaning (raw and measured, I and Q,</span>
<span class="sd">  a set of fit parameters, that sort of thing, that all get measured/calculated</span>
<span class="sd">  at once):</span>
<span class="sd">    parameter should have .names and optional .labels, each a sequence with</span>
<span class="sd">    the same length as returned by .get()</span>

<span class="sd">- an array of values of one type:</span>
<span class="sd">    parameter should have .name and optional .label as above, but also</span>
<span class="sd">    .shape attribute, which is an integer (or tuple of integers) describing</span>
<span class="sd">    the shape of the returned array (which must be fixed)</span>
<span class="sd">    optionally also .setpoints, array(s) of setpoint values for this data</span>
<span class="sd">    otherwise we will use integers from 0 in each direction as the setpoints</span>

<span class="sd">- several arrays of values (all the same shape):</span>
<span class="sd">    define .names (and .labels) AND .shape (and .setpoints)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="kn">from</span> <span class="nn">qcodes.utils.deferred_operations</span> <span class="kn">import</span> <span class="n">DeferredOperations</span>
<span class="kn">from</span> <span class="nn">qcodes.utils.helpers</span> <span class="kn">import</span> <span class="p">(</span><span class="n">permissive_range</span><span class="p">,</span> <span class="n">wait_secs</span><span class="p">,</span> <span class="n">is_sequence_of</span><span class="p">,</span>
                                  <span class="n">DelegateAttributes</span><span class="p">,</span> <span class="n">full_class</span><span class="p">,</span> <span class="n">named_repr</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">qcodes.utils.metadata</span> <span class="kn">import</span> <span class="n">Metadatable</span>
<span class="kn">from</span> <span class="nn">qcodes.utils.command</span> <span class="kn">import</span> <span class="n">Command</span><span class="p">,</span> <span class="n">NoCommandError</span>
<span class="kn">from</span> <span class="nn">qcodes.utils.validators</span> <span class="kn">import</span> <span class="n">Validator</span><span class="p">,</span> <span class="n">Numbers</span><span class="p">,</span> <span class="n">Ints</span><span class="p">,</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">Anything</span>
<span class="kn">from</span> <span class="nn">qcodes.instrument.sweep_values</span> <span class="kn">import</span> <span class="n">SweepFixedValues</span>
<span class="kn">from</span> <span class="nn">qcodes.data.data_array</span> <span class="kn">import</span> <span class="n">DataArray</span>


<span class="k">def</span> <span class="nf">no_setter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This Parameter has no setter defined.&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">no_getter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="s1">&#39;This Parameter has no getter, use .get_latest to get the most recent &#39;</span>
        <span class="s1">&#39;set value.&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Parameter"><a class="viewcode-back" href="../../../api/generated/qcodes.Parameter.html#qcodes.Parameter">[docs]</a><span class="k">class</span> <span class="nc">Parameter</span><span class="p">(</span><span class="n">Metadatable</span><span class="p">,</span> <span class="n">DeferredOperations</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define one generic parameter, not necessarily part of</span>
<span class="sd">    an instrument. can be settable and/or gettable.</span>

<span class="sd">    A settable Parameter has a .set method, and supports only a single value</span>
<span class="sd">    at a time (see below)</span>

<span class="sd">    A gettable Parameter has a .get method, which may return:</span>

<span class="sd">    1.  a single value</span>
<span class="sd">    2.  a sequence of values with different names (for example,</span>
<span class="sd">        raw and interpreted, I and Q, several fit parameters...)</span>
<span class="sd">    3.  an array of values all with the same name, but at different</span>
<span class="sd">        setpoints (for example, a time trace or fourier transform that</span>
<span class="sd">        was acquired in the hardware and all sent to the computer at once)</span>
<span class="sd">    4.  2 &amp; 3 together: a sequence of arrays. All arrays should be the same</span>
<span class="sd">        shape.</span>
<span class="sd">    5.  a sequence of differently shaped items</span>

<span class="sd">    Because .set only supports a single value, if a Parameter is both</span>
<span class="sd">    gettable AND settable, .get should return a single value too (case 1)</span>

<span class="sd">    Parameters have a .get_latest method that simply returns the most recent</span>
<span class="sd">    set or measured value. This can either be called ( param.get_latest() )</span>
<span class="sd">    or used in a Loop as if it were a (gettable-only) parameter itself:</span>
<span class="sd">        Loop(...).each(param.get_latest)</span>


<span class="sd">    The constructor arguments change somewhat between these cases:</span>

<span class="sd">    Todo:</span>
<span class="sd">        no idea how to document such a constructor</span>

<span class="sd">    Args:</span>
<span class="sd">        name: (1&amp;3) the local name of this parameter, should be a valid</span>
<span class="sd">            identifier, ie no spaces or special characters</span>

<span class="sd">        names: (2,4,5) a tuple of names</span>

<span class="sd">        label: (1&amp;3) string to use as an axis label for this parameter</span>
<span class="sd">            defaults to name</span>

<span class="sd">        labels: (2,4,5) a tuple of labels</span>

<span class="sd">        units: (1&amp;3) string that indicates units of parameter for use in axis</span>
<span class="sd">            label and snapshot</span>

<span class="sd">        shape: (3&amp;4) a tuple of integers for the shape of array returned by</span>
<span class="sd">            .get().</span>

<span class="sd">        shapes: (5) a tuple of tuples, each one as in `shape`.</span>
<span class="sd">            Single values should be denoted by None or ()</span>

<span class="sd">        setpoints: (3,4,5) the setpoints for the returned array of values.</span>
<span class="sd">            3&amp;4 - a tuple of arrays. The first array is be 1D, the second 2D,</span>
<span class="sd">                etc.</span>
<span class="sd">            5 - a tuple of tuples of arrays</span>
<span class="sd">            Defaults to integers from zero in each respective direction</span>
<span class="sd">            Each may be either a DataArray, a numpy array, or a sequence</span>
<span class="sd">            (sequences will be converted to numpy arrays)</span>
<span class="sd">            NOTE: if the setpoints will be different each measurement, leave</span>
<span class="sd">            this out and return the setpoints (with extra names) in the get.</span>

<span class="sd">        setpoint_names: (3,4,5) one identifier (like `name`) per setpoint</span>
<span class="sd">            array. Ignored if `setpoints` are DataArrays, which already have</span>
<span class="sd">            names.</span>

<span class="sd">        setpoint_labels: (3&amp;4) one label (like `label`) per setpoint array.</span>
<span class="sd">            Overridden if `setpoints` are DataArrays and already have labels.</span>

<span class="sd">        vals: allowed values for setting this parameter (only relevant</span>
<span class="sd">            if it has a setter),  defaults to Numbers()</span>

<span class="sd">        docstring (Optional[string]): documentation string for the __doc__</span>
<span class="sd">            field of the object. The __doc__ field of the instance is used by</span>
<span class="sd">            some help systems, but not all</span>

<span class="sd">        snapshot_get (bool): Prevent any update to the parameter</span>
<span class="sd">          for example if it takes too long to update</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Parameter.__init__"><a class="viewcode-back" href="../../../api/generated/qcodes.Parameter.html#qcodes.Parameter.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">shape</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">setpoints</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">setpoint_names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">setpoint_labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">vals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">docstring</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">snapshot_get</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_snapshot_get</span> <span class="o">=</span> <span class="n">snapshot_get</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">has_get</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_set</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meta_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;setpoint_names&#39;</span><span class="p">,</span> <span class="s1">&#39;setpoint_labels&#39;</span><span class="p">]</span>

        <span class="c1"># always let the parameter have a single name (in fact, require this!)</span>
        <span class="c1"># even if it has names too</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># check for names first - that way you can provide both name</span>
            <span class="c1"># AND names for instrument parameters - name is how you get the</span>
            <span class="c1"># object (from the parameters dict or the delegated attributes),</span>
            <span class="c1"># and names are the items it returns</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">names</span> <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span> <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_validator</span><span class="p">(</span><span class="n">vals</span> <span class="ow">or</span> <span class="n">Anything</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
                <span class="s1">&#39;Parameter class:&#39;</span><span class="p">,</span>
                <span class="s1">&#39;* `names` </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">),</span>
                <span class="s1">&#39;* `labels` </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">),</span>
                <span class="s1">&#39;* `units` </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">name</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span> <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># vals / validate only applies to simple single-value parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_validator</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="c1"># generate default docstring</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
                <span class="s1">&#39;Parameter class:&#39;</span><span class="p">,</span>
                <span class="s1">&#39;* `name` </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;* `label` </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                <span class="c1"># TODO is this unit s a typo? shouldnt that be unit?</span>
                <span class="s1">&#39;* `units` </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                <span class="s1">&#39;* `vals` </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vals</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;vals&#39;</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;either name or names is required&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">shapes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nt</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_sequence_of</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;shape must be a tuple of ints, not &#39;</span> <span class="o">+</span>
                                     <span class="nb">repr</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">container_str</span> <span class="o">=</span> <span class="s1">&#39;tuple&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_sequence_of</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;shapes must be a tuple of tuples &#39;</span>
                                     <span class="s1">&#39;of ints, not &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="n">shapes</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">container_str</span> <span class="o">=</span> <span class="s1">&#39;tuple of tuples&#39;</span>

            <span class="n">sp_types</span> <span class="o">=</span> <span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">DataArray</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Sequence</span><span class="p">,</span>
                        <span class="n">collections</span><span class="o">.</span><span class="n">Iterator</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">setpoints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">is_sequence_of</span><span class="p">(</span><span class="n">setpoints</span><span class="p">,</span> <span class="n">sp_types</span><span class="p">,</span> <span class="n">depth</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;setpoints must be a {} of arrays&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">container_str</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">setpoint_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">is_sequence_of</span><span class="p">(</span><span class="n">setpoint_names</span><span class="p">,</span> <span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="n">depth</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;setpoint_names must be a {} &#39;</span>
                                 <span class="s1">&#39;of strings&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">container_str</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">setpoint_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="n">is_sequence_of</span><span class="p">(</span><span class="n">setpoint_labels</span><span class="p">,</span> <span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="n">depth</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;setpoint_labels must be a {} &#39;</span>
                                 <span class="s1">&#39;of strings&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">container_str</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">setpoints</span> <span class="o">=</span> <span class="n">setpoints</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setpoint_names</span> <span class="o">=</span> <span class="n">setpoint_names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setpoint_labels</span> <span class="o">=</span> <span class="n">setpoint_labels</span>

        <span class="c1"># record of latest value and when it was set or measured</span>
        <span class="c1"># what exactly this means is different for different subclasses</span>
        <span class="c1"># but they all use the same attributes so snapshot is consistent.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latest_value</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latest_ts</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">docstring</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span> <span class="o">=</span> <span class="n">docstring</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_latest</span> <span class="o">=</span> <span class="n">GetLatest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">named_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_get</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NoCommandError</span><span class="p">(</span><span class="s1">&#39;no get cmd found in&#39;</span> <span class="o">+</span>
                                     <span class="s1">&#39; Parameter {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_set</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NoCommandError</span><span class="p">(</span><span class="s1">&#39;no set cmd found in&#39;</span> <span class="o">+</span>
                                     <span class="s1">&#39; Parameter {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_latest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latest_value</span><span class="p">,</span>
            <span class="s1">&#39;ts&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latest_ts</span>
        <span class="p">}</span>

    <span class="c1"># get_attrs ignores leading underscores, unless they&#39;re in this list</span>
    <span class="n">_keep_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;_vals&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Parameter.get_attrs"><a class="viewcode-back" href="../../../api/generated/qcodes.Parameter.html#qcodes.Parameter.get_attrs">[docs]</a>    <span class="k">def</span> <span class="nf">get_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attributes recreated as properties in the RemoteParameter proxy.</span>

<span class="sd">        Grab the names of all attributes that the RemoteParameter needs</span>
<span class="sd">        to function like the main one (in loops etc)</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: All public attribute names, plus docstring and _vals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span> <span class="ow">and</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_attrs</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">))):</span>
                <span class="k">continue</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Parameter.snapshot_base"><a class="viewcode-back" href="../../../api/generated/qcodes.Parameter.html#qcodes.Parameter.snapshot_base">[docs]</a>    <span class="k">def</span> <span class="nf">snapshot_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        State of the parameter as a JSON-compatible dict.</span>

<span class="sd">        Args:</span>
<span class="sd">            update (bool): If True, update the state by calling parameter.get().</span>
<span class="sd">             If False, just use the latest values in memory.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: base snapshot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_get</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_snapshot_get</span> <span class="ow">and</span> <span class="n">update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latest</span><span class="p">()</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;__class__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">state</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta_attrs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;instrument&#39;</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_instrument&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                    <span class="s1">&#39;instrument&#39;</span><span class="p">:</span> <span class="n">full_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="p">),</span>
                    <span class="s1">&#39;instrument_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">name</span>
                <span class="p">})</span>

            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                <span class="n">state</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">state</span></div>

    <span class="k">def</span> <span class="nf">_save_val</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latest_value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latest_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<div class="viewcode-block" id="Parameter.set_validator"><a class="viewcode-back" href="../../../api/generated/qcodes.Parameter.html#qcodes.Parameter.set_validator">[docs]</a>    <span class="k">def</span> <span class="nf">set_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a validator `vals` for this parameter.</span>

<span class="sd">        Args:</span>
<span class="sd">            vals (Validator):  validator to set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vals</span> <span class="o">=</span> <span class="n">Numbers</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">Validator</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vals</span> <span class="o">=</span> <span class="n">vals</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;vals must be a Validator&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameter.validate"><a class="viewcode-back" href="../../../api/generated/qcodes.Parameter.html#qcodes.Parameter.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate value</span>

<span class="sd">        Args:</span>
<span class="sd">            value (any): value to validate</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_instrument&#39;</span><span class="p">):</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span>
                       <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">__class__</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vals</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;Parameter: &#39;</span> <span class="o">+</span> <span class="n">context</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameter.sweep"><a class="viewcode-back" href="../../../api/generated/qcodes.Parameter.html#qcodes.Parameter.sweep">[docs]</a>    <span class="k">def</span> <span class="nf">sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a collection of parameter values to be iterated over.</span>
<span class="sd">        Requires `start` and `stop` and (`step` or `num`)</span>
<span class="sd">        The sign of `step` is not relevant.</span>

<span class="sd">        Args:</span>
<span class="sd">            start (Union[int, float]): The starting value of the sequence.</span>
<span class="sd">            stop (Union[int, float]): The end value of the sequence.</span>
<span class="sd">            step (Optional[Union[int, float]]):  Spacing between values.</span>
<span class="sd">            num (Optional[int]): Number of values to generate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SweepFixedValues: collection of parameter values to be</span>
<span class="sd">                iterated over</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; sweep(0, 10, num=5)</span>
<span class="sd">             [0.0, 2.5, 5.0, 7.5, 10.0]</span>
<span class="sd">            &gt;&gt;&gt; sweep(5, 10, step=1)</span>
<span class="sd">            [5.0, 6.0, 7.0, 8.0, 9.0, 10.0]</span>
<span class="sd">            &gt;&gt;&gt; sweep(15, 10.5, step=1.5)</span>
<span class="sd">            &gt;[15.0, 13.5, 12.0, 10.5]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SweepFixedValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span>
                                <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parameter.__getitem__"><a class="viewcode-back" href="../../../api/generated/qcodes.Parameter.html#qcodes.Parameter.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Slice a Parameter to get a SweepValues object</span>
<span class="sd">        to iterate over during a sweep</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SweepFixedValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Include the instrument name with the Parameter name if possible.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">inst_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">inst_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">inst_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">full_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Include the instrument name with the Parameter names if possible.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">inst_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">inst_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">inst_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span></div>


<div class="viewcode-block" id="StandardParameter"><a class="viewcode-back" href="../../../api/generated/qcodes.StandardParameter.html#qcodes.StandardParameter">[docs]</a><span class="k">class</span> <span class="nc">StandardParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define one measurement parameter.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (string): the local name of this parameter</span>
<span class="sd">        instrument (Optional[Instrument]): an instrument that handles this</span>
<span class="sd">            function. Default None.</span>

<span class="sd">        get_cmd (Optional[Union[string, function]]): a string or function to</span>
<span class="sd">            get this parameter. You can only use a string if an instrument is</span>
<span class="sd">            provided, then this string will be passed to instrument.ask</span>

<span class="sd">        get_parser ( Optional[function]): function to transform the response</span>
<span class="sd">            from get to the final output value.</span>
<span class="sd">            See also val_mapping</span>

<span class="sd">        set_cmd (Optional[Union[string, function]]): command to set this</span>
<span class="sd">            parameter, either:</span>
<span class="sd">            - a string (containing one field to .format, like &quot;{}&quot; etc)</span>
<span class="sd">              you can only use a string if an instrument is provided,</span>
<span class="sd">              this string will be passed to instrument.write</span>
<span class="sd">            - a function (of one parameter)</span>

<span class="sd">        set_parser (Optional[function]): function to transform the input set</span>
<span class="sd">            value to an encoded value sent to the instrument.</span>
<span class="sd">            See also val_mapping</span>

<span class="sd">        val_mapping (Optional[dict]): a bidirectional map data/readable values</span>
<span class="sd">            to instrument codes, expressed as a dict:</span>
<span class="sd">            ``{data_val: instrument_code}``</span>
<span class="sd">            For example, if the instrument uses &#39;0&#39; to mean 1V and &#39;1&#39; to mean</span>
<span class="sd">            10V, set val_mapping={1: &#39;0&#39;, 10: &#39;1&#39;} and on the user side you</span>
<span class="sd">            only see 1 and 10, never the coded &#39;0&#39; and &#39;1&#39;</span>

<span class="sd">            If vals is omitted, will also construct a matching Enum validator.</span>
<span class="sd">            NOTE: only applies to get if get_cmd is a string, and to set if</span>
<span class="sd">            set_cmd is a string.</span>

<span class="sd">            You can use ``val_mapping`` with ``get_parser``, in which case</span>
<span class="sd">            ``get_parser`` acts on the return value from the instrument first,</span>
<span class="sd">            then ``val_mapping`` is applied (in reverse).</span>

<span class="sd">            You CANNOT use ``val_mapping`` and ``set_parser`` together - that</span>
<span class="sd">            would just provide too many ways to do the same thing.</span>

<span class="sd">        vals (Optional[Validator]): a Validator object for this parameter</span>

<span class="sd">        delay (Optional[Union[int, float]]): time (in seconds) to wait after</span>
<span class="sd">            the *start* of each set, whether part of a sweep or not. Can be</span>
<span class="sd">            set to 0 to go maximum speed with no errors.</span>

<span class="sd">        max_delay (Optional[Union[int, float]]): If &gt; delay, we don&#39;t emit a</span>
<span class="sd">            warning unless the time taken during a single set is greater than</span>
<span class="sd">            this, even though we aim for delay.</span>

<span class="sd">        step (Optional[Union[int, float]]): max increment of parameter value.</span>
<span class="sd">            Larger changes are broken into multiple steps this size.</span>

<span class="sd">        max_val_age (Optional[Union[int, float]]): max time (in seconds) to</span>
<span class="sd">            trust a saved value from this parameter as the starting point of</span>
<span class="sd">            a sweep.</span>

<span class="sd">        **kwargs: Passed to Parameter parent class</span>

<span class="sd">    Raises:</span>
<span class="sd">        NoCommandError: if get and set are not found</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="StandardParameter.__init__"><a class="viewcode-back" href="../../../api/generated/qcodes.StandardParameter.html#qcodes.StandardParameter.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">instrument</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">get_cmd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">get_parser</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">set_cmd</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">set_parser</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">delay</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_val_age</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
                 <span class="n">vals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">val_mapping</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># handle val_mapping before super init because it impacts</span>
        <span class="c1"># vals / validation in the base class</span>
        <span class="k">if</span> <span class="n">val_mapping</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="n">val_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_get_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

            <span class="k">if</span> <span class="n">get_parser</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">get_parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valmapping_get_parser</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># First run get_parser, then run the result through</span>
                <span class="c1"># val_mapping</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_preparser</span> <span class="o">=</span> <span class="n">get_parser</span>
                <span class="n">get_parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valmapping_with_preparser</span>

            <span class="k">if</span> <span class="n">set_parser</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_mapping</span> <span class="o">=</span> <span class="n">val_mapping</span>
                <span class="n">set_parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_mapping</span><span class="o">.</span><span class="n">__getitem__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s1">&#39;You cannot use set_parser and val_mapping together.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">get_parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_cmd</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;get_parser is set, but will not be used &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;(name </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span> <span class="o">=</span> <span class="n">instrument</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_meta_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;instrument&#39;</span><span class="p">,</span> <span class="s1">&#39;sweep_step&#39;</span><span class="p">,</span> <span class="s1">&#39;sweep_delay&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;max_sweep_delay&#39;</span><span class="p">])</span>

        <span class="c1"># stored value from last .set() or .get()</span>
        <span class="c1"># normally only used by set with a sweep, to avoid</span>
        <span class="c1"># having to call .get() for every .set()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_val_age</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_get</span><span class="p">(</span><span class="n">get_cmd</span><span class="p">,</span> <span class="n">get_parser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_set</span><span class="p">(</span><span class="n">set_cmd</span><span class="p">,</span> <span class="n">set_parser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_delay</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">max_delay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_step</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">max_val_age</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_get</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_set</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">NoCommandError</span><span class="p">(</span><span class="s1">&#39;neither set nor get cmd found in&#39;</span> <span class="o">+</span>
                                 <span class="s1">&#39; Parameter {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="StandardParameter.get"><a class="viewcode-back" href="../../../api/generated/qcodes.StandardParameter.html#qcodes.StandardParameter.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_val</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="p">(</span>
                <span class="s1">&#39;getting {}:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),)</span>
            <span class="k">raise</span> <span class="n">e</span></div>

    <span class="k">def</span> <span class="nf">_valmapping_get_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get parser to be used in the case that a val_mapping is defined</span>
<span class="sd">        and a separate get_parser is not defined.</span>

<span class="sd">        Tries to match against defined strings in the mapping dictionary. If</span>
<span class="sd">        there are no matches, we try to convert the val into an integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Try and match the raw value from the instrument directly</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mapping</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># If there is no match, we can try to convert the parameter into a</span>
        <span class="c1"># numeric value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mapping</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Unmapped value from instrument: {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_valmapping_with_preparser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valmapping_get_parser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_preparser</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_cmd</span><span class="p">,</span> <span class="n">get_parser</span><span class="p">):</span>
        <span class="n">exec_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">ask</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="n">arg_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="n">get_cmd</span><span class="p">,</span> <span class="n">exec_str</span><span class="o">=</span><span class="n">exec_str</span><span class="p">,</span>
                            <span class="n">output_parser</span><span class="o">=</span><span class="n">get_parser</span><span class="p">,</span>
                            <span class="n">no_cmd_function</span><span class="o">=</span><span class="n">no_getter</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">get_cmd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_get</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_set_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_cmd</span><span class="p">,</span> <span class="n">set_parser</span><span class="p">):</span>
        <span class="c1"># note: this does not set the final setter functions. that&#39;s handled</span>
        <span class="c1"># in self.set_sweep, when we choose a swept or non-swept setter.</span>
        <span class="n">exec_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">write</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span> <span class="o">=</span> <span class="n">Command</span><span class="p">(</span><span class="n">arg_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="n">set_cmd</span><span class="p">,</span> <span class="n">exec_str</span><span class="o">=</span><span class="n">exec_str</span><span class="p">,</span>
                            <span class="n">input_parser</span><span class="o">=</span><span class="n">set_parser</span><span class="p">,</span> <span class="n">no_cmd_function</span><span class="o">=</span><span class="n">no_setter</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">set_cmd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_set</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_validate_and_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_val</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">clock</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_set_ts</span><span class="p">(</span><span class="n">clock</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">remainder</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="p">(</span>
                <span class="s1">&#39;setting {}:{} to {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)),)</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">_sweep_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">oldest_ok_val</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_val_age</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latest</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">oldest_ok_val</span><span class="p">:</span>
            <span class="n">start_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_value</span> <span class="o">=</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">start_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">start_value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))):</span>
            <span class="c1"># something weird... parameter is numeric but one of the ends</span>
            <span class="c1"># isn&#39;t, even though it&#39;s valid.</span>
            <span class="c1"># probably a MultiType with a mix of numeric and non-numeric types</span>
            <span class="c1"># just set the endpoint and move on</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;cannot sweep {} from {} to {} - jumping.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">start_value</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># drop the initial value, we&#39;re already there</span>
        <span class="k">return</span> <span class="n">permissive_range</span><span class="p">(</span><span class="n">start_value</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_update_set_ts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_clock</span><span class="p">):</span>
        <span class="c1"># calculate the delay time to the *max* delay,</span>
        <span class="c1"># then take off up to the tolerance</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay_tolerance</span>
        <span class="n">step_clock</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay</span>
        <span class="n">remainder</span> <span class="o">=</span> <span class="n">wait_secs</span><span class="p">(</span><span class="n">step_clock</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">remainder</span> <span class="o">&lt;=</span> <span class="n">tolerance</span><span class="p">:</span>
            <span class="c1"># don&#39;t allow extra delays to compound</span>
            <span class="n">step_clock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
            <span class="n">remainder</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">remainder</span> <span class="o">-=</span> <span class="n">tolerance</span>
        <span class="k">return</span> <span class="n">step_clock</span><span class="p">,</span> <span class="n">remainder</span>

    <span class="k">def</span> <span class="nf">_validate_and_sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">step_clock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">step_val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweep_steps</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">step_val</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_save_val</span><span class="p">(</span><span class="n">step_val</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">step_clock</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_set_ts</span><span class="p">(</span><span class="n">step_clock</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">remainder</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_val</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">step_clock</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_set_ts</span><span class="p">(</span><span class="n">step_clock</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">remainder</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="p">(</span>
                <span class="s1">&#39;setting {}:{} to {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)),)</span>
            <span class="k">raise</span> <span class="n">e</span>

<div class="viewcode-block" id="StandardParameter.set_step"><a class="viewcode-back" href="../../../api/generated/qcodes.StandardParameter.html#qcodes.StandardParameter.set_step">[docs]</a>    <span class="k">def</span> <span class="nf">set_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">max_val_age</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure whether this Parameter uses steps during set operations.</span>
<span class="sd">        If step is a positive number, this is the maximum value change</span>
<span class="sd">        allowed in one hardware call, so a single set can result in many</span>
<span class="sd">        calls to the hardware if the starting value is far from the target.</span>

<span class="sd">        Args:</span>
<span class="sd">            step (Union[int, float]): A positive number, the largest change</span>
<span class="sd">                allowed in one call. All but the final change will attempt to</span>
<span class="sd">                change by +/- step exactly</span>

<span class="sd">            max_val_age (Optional[int]): Only used with stepping, the max time</span>
<span class="sd">                (in seconds) to trust a saved value. If this parameter has not</span>
<span class="sd">                been set or measured more recently than this, it will be</span>
<span class="sd">                measured before starting to step, so we&#39;re confident in the</span>
<span class="sd">                value we&#39;re starting from.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: if step is not numeric</span>
<span class="sd">            ValueError: if step is negative</span>
<span class="sd">            TypeError:  if step is not integer for an integer parameter</span>
<span class="sd">            TypeError: if step is not a number</span>
<span class="sd">            TypeError: if max_val_age is not numeric</span>
<span class="sd">            ValueError: if max_val_age is negative</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span><span class="p">:</span>
            <span class="c1"># single-command setting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_and_set</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vals</span><span class="o">.</span><span class="n">is_numeric</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;you can only step numeric parameters&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">step</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;step must be positive&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vals</span><span class="p">,</span> <span class="n">Ints</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s1">&#39;step must be a positive int for an Ints parameter&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;step must be a number&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># stepped setting</span>
            <span class="k">if</span> <span class="n">max_val_age</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_val_age</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s1">&#39;max_val_age must be a number&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">max_val_age</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_val_age must be non-negative&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_val_age</span> <span class="o">=</span> <span class="n">max_val_age</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_step</span> <span class="o">=</span> <span class="n">step</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_and_sweep</span></div>

<div class="viewcode-block" id="StandardParameter.get_delay"><a class="viewcode-back" href="../../../api/generated/qcodes.StandardParameter.html#qcodes.StandardParameter.get_delay">[docs]</a>    <span class="k">def</span> <span class="nf">get_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the delay time of this parameter. Also see `set_delay` &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay</span></div>

<div class="viewcode-block" id="StandardParameter.set_delay"><a class="viewcode-back" href="../../../api/generated/qcodes.StandardParameter.html#qcodes.StandardParameter.set_delay">[docs]</a>    <span class="k">def</span> <span class="nf">set_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Configure this parameter with a delay between set operations.</span>

<span class="sd">        Typically used in conjunction with set_step to create an effective</span>
<span class="sd">        ramp rate, but can also be used without a step to enforce a delay</span>
<span class="sd">        after every set.</span>
<span class="sd">        If delay and max_delay are both None or 0, we never emit warnings</span>
<span class="sd">        no matter how long the set takes.</span>

<span class="sd">        Args:</span>
<span class="sd">            delay(Union[int, float]): the target time between set calls. The</span>
<span class="sd">                actual time will not be shorter than this, but may be longer</span>
<span class="sd">                if the underlying set call takes longer.</span>

<span class="sd">            max_delay(Optional[Union[int, float]]): if given, the longest time</span>
<span class="sd">                allowed for the underlying set call before we emit a warning.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If delay is not int nor float</span>
<span class="sd">            TypeError: If max_delay is not int nor float</span>
<span class="sd">            ValueError: If delay is negative</span>
<span class="sd">            ValueError: If max_delay is smaller than delay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">delay</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;delay must be a number&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delay</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;delay must not be negative&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delay</span> <span class="o">=</span> <span class="n">delay</span>

        <span class="k">if</span> <span class="n">max_delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_delay</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s1">&#39;max_delay must be a either  int or a float&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">max_delay</span> <span class="o">&lt;</span> <span class="n">delay</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;max_delay must be no shorter than delay&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delay_tolerance</span> <span class="o">=</span> <span class="n">max_delay</span> <span class="o">-</span> <span class="n">delay</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delay_tolerance</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delay</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay_tolerance</span><span class="p">):</span>
            <span class="c1"># denotes that we shouldn&#39;t follow the wait code or</span>
            <span class="c1"># emit any warnings</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delay</span> <span class="o">=</span> <span class="bp">None</span></div></div>


<span class="k">class</span> <span class="nc">ManualParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define one parameter that reflects a manual setting / configuration.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (string): the local name of this parameter</span>

<span class="sd">        instrument (Optional[Instrument]): the instrument this applies to,</span>
<span class="sd">            if any.</span>

<span class="sd">        initial_value (Optional[string]): starting value, the</span>
<span class="sd">            only invalid value allowed, and None is only allowed as an initial</span>
<span class="sd">            value, it cannot be set later</span>

<span class="sd">        **kwargs: Passed to Parameter parent class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">instrument</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">initial_value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span> <span class="o">=</span> <span class="n">instrument</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meta_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;instrument&#39;</span><span class="p">,</span> <span class="s1">&#39;initial_value&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">initial_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">initial_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_val</span><span class="p">(</span><span class="n">initial_value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">has_get</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_set</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate and saves value</span>
<span class="sd">        Args:</span>
<span class="sd">            value (any): value to validate and save</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_val</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return latest value&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latest</span><span class="p">()[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">GetLatest</span><span class="p">(</span><span class="n">DelegateAttributes</span><span class="p">,</span> <span class="n">DeferredOperations</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for a Parameter that just returns the last set or measured value</span>
<span class="sd">    stored in the Parameter itself.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Can be called:</span>
<span class="sd">        &gt;&gt;&gt; param.get_latest()</span>
<span class="sd">        &gt;&gt;&gt; # Or used as if it were a gettable-only parameter itself:</span>
<span class="sd">        &gt;&gt;&gt; Loop(...).each(param.get_latest)</span>

<span class="sd">    Args:</span>
<span class="sd">        parameter (Parameter): Parameter to be wrapped</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter</span> <span class="o">=</span> <span class="n">parameter</span>

    <span class="n">delegate_attr_objects</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;parameter&#39;</span><span class="p">]</span>
    <span class="n">omit_delegate_attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;set&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return latest value&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter</span><span class="o">.</span><span class="n">_latest</span><span class="p">()[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>