

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating Simulated PyVISA Instruments &mdash; QCoDeS 0.1.7 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="QCoDeS 0.1.7 documentation" href="../index.html"/>
        <link rel="up" title="Examples of using QCoDeS" href="../examples/index.html"/>
        <link rel="next" title="Datasaving Examples" href="Datasaving examples.html"/>
        <link rel="prev" title="Creating QCoDeS instrument drivers" href="Creating Instrument Drivers.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> QCoDeS
          

          
          </a>

          
            
            
              <div class="version">
                0.1.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">Get Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Classes and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/generated/qcodes.instrument_drivers.html">qcodes.instrument_drivers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Qcodes project plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes/index.html">Changelogs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples/index.html">Examples of using QCoDeS</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../examples/index.html#basic-examples">Basic examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Combined Parameters.html">Combined Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="Comprehensive Plotting How-To.html">Comprehensive Plotting How-To</a></li>
<li class="toctree-l3"><a class="reference internal" href="Configuring_QCoDeS.html">QCoDeS config</a></li>
<li class="toctree-l3"><a class="reference internal" href="Creating Instrument Drivers.html">Creating QCoDeS instrument drivers</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Creating Simulated PyVISA Instruments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what">What?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#not">Not!</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how">How?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-weinschel-8320">Example: Weinschel_8320</a></li>
<li class="toctree-l4"><a class="reference internal" href="#congratulations-that-was-it">Congratulations! That was it.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bonus-example-including-parameters-in-the-simulated-instrument">Bonus example: including parameters in the simulated instrument</a></li>
<li class="toctree-l4"><a class="reference internal" href="#that-s-it">That’s it!</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Datasaving examples.html">Datasaving Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="Measure without a Loop.html">Measure without a Loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="Metadata.html">Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="Metadata with instruments.html">Metadata with instruments</a></li>
<li class="toctree-l3"><a class="reference internal" href="Parameters.html">Parameters in QCoDeS</a></li>
<li class="toctree-l3"><a class="reference internal" href="Qcodes location-format example.html">Qcodes location-format example</a></li>
<li class="toctree-l3"><a class="reference internal" href="Tutorial.html">QCoDeS tutorial</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#drivers">Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html#benchmarking">Benchmarking</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QCoDeS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../examples/index.html">Examples of using QCoDeS</a> &raquo;</li>
        
      <li>Creating Simulated PyVISA Instruments</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/_notebooks/Creating Simulated PyVISA Instruments.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creating-simulated-pyvisa-instruments">
<h1>Creating Simulated PyVISA Instruments<a class="headerlink" href="#creating-simulated-pyvisa-instruments" title="Permalink to this headline">¶</a></h1>
<p>When developing stuff in a large codebase like QCoDeS, it is often
uncanningly easy to submit a change that breaks stuff. Therefore,
<em>continuous integration</em> is performed in the form of automated tests
that run before new code is allowed into the codebase. The many tests of
QCoDeS can be found in <code class="docutils literal"><span class="pre">qcodes.tests</span></code>.</p>
<p>But how about drivers? They constitute the majority of the codebase, but
how can we test them? Wouldn’t that require a physical copy each
instrument to be present on the California server where we run our
tests? It used to be so, but not anymore! For drivers utilising PyVISA
(i.e. <code class="docutils literal"><span class="pre">VisaInstrument</span></code> drivers), we may create simulated instruments
to which the drivers may connect.</p>
<div class="section" id="what">
<h2>What?<a class="headerlink" href="#what" title="Permalink to this headline">¶</a></h2>
<p>This way, we may instantiate drivers and run simple tests on them. Tests
like:</p>
<ul class="simple">
<li>Can the driver even instantiate? This is very relevant when
underlying APIs change.</li>
<li>Is the drivers (e.g.) “voltage-to-bytecode” converter working
properly?</li>
</ul>
</div>
<div class="section" id="not">
<h2>Not!<a class="headerlink" href="#not" title="Permalink to this headline">¶</a></h2>
<p>It is not feasible to simulate any but the most trivial features of the
instrument. Simulated instruments can not and should not perform tests
like:</p>
<ul class="simple">
<li>Do we wait sufficiently long for this oscilloscope’s trace to be
acquired?</li>
<li>Does our driver handle overlapping commands of this AWG correctly?</li>
</ul>
</div>
<div class="section" id="how">
<h2>How?<a class="headerlink" href="#how" title="Permalink to this headline">¶</a></h2>
<p>The basic scheme goes as follows:</p>
<ul class="simple">
<li>Write a <code class="docutils literal"><span class="pre">.yaml</span></code> file for the simulated instrument. The instructions
for that may be found here:
<a class="reference external" href="https://pyvisa-sim.readthedocs.io/en/latest/">https://pyvisa-sim.readthedocs.io/en/latest/</a> and specifically here:
<a class="reference external" href="https://pyvisa-sim.readthedocs.io/en/latest/definitions.html#definitions">https://pyvisa-sim.readthedocs.io/en/latest/definitions.html#definitions</a></li>
<li>Then write a test for your instrument and put it in
<code class="docutils literal"><span class="pre">qcodes/tests/drivers</span></code>. The file should have the name
<code class="docutils literal"><span class="pre">test_&lt;nameofyourdriver&gt;.py</span></code>.</li>
<li>Check that all is well by running
<code class="docutils literal"><span class="pre">$</span> <span class="pre">pytest</span> <span class="pre">test_&lt;nameofyourdriver&gt;.py</span></code>.</li>
</ul>
<p>Below is an example.</p>
</div>
<div class="section" id="example-weinschel-8320">
<h2>Example: Weinschel_8320<a class="headerlink" href="#example-weinschel-8320" title="Permalink to this headline">¶</a></h2>
<p>The Weinschel 8320 is a very simple driver.</p>
<div class="code ipython3 highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qcodes.instrument.visa</span> <span class="k">import</span> <span class="n">VisaInstrument</span>
<span class="kn">import</span> <span class="nn">qcodes.utils.validators</span> <span class="k">as</span> <span class="nn">vals</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">class</span> <span class="nc">Weinschel_8320</span><span class="p">(</span><span class="n">VisaInstrument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    QCoDeS driver for the stepped attenuator</span>
<span class="sd">    Weinschel is formerly known as Aeroflex/Weinschel</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">terminator</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;attenuation&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;dB&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="s1">&#39;ATTN ALL </span><span class="si">{:02.0f}</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="s1">&#39;ATTN? 1&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">60.1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect_message</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="the-yaml-file">
<h3>The <code class="docutils literal"><span class="pre">.yaml</span></code> file<a class="headerlink" href="#the-yaml-file" title="Permalink to this headline">¶</a></h3>
<p>The simplest <code class="docutils literal"><span class="pre">.yaml</span></code> file that is still useful, reads, in all its
glory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">spec</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span>
<span class="n">devices</span><span class="p">:</span>
  <span class="n">device</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">eom</span><span class="p">:</span>
      <span class="n">GPIB</span> <span class="n">INSTR</span><span class="p">:</span>
        <span class="n">q</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span>  <span class="c1"># MAKE SURE! that this matches the terminator of the driver!</span>
        <span class="n">r</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">ERROR</span>
    <span class="n">dialogues</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">q</span><span class="p">:</span> <span class="s2">&quot;*IDN?&quot;</span>
        <span class="n">r</span><span class="p">:</span> <span class="s2">&quot;QCoDeS, Weinschel 8320 (Simulated), 1337, 0.0.01&quot;</span>


<span class="n">resources</span><span class="p">:</span>
  <span class="n">GPIB</span><span class="p">::</span><span class="mi">1</span><span class="p">::</span><span class="n">INSTR</span><span class="p">:</span>
    <span class="n">device</span><span class="p">:</span> <span class="n">device</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Note that since no physical connection is made, it doesn’t matter what
interface we pretend to use (GPIB, USB, ethernet, serial, …). As a
convention, we always write GPIB in the <code class="docutils literal"><span class="pre">.yaml</span></code> files.</p>
<p>We save the above file as
<code class="docutils literal"><span class="pre">qcodes/instrument/sims/Weinschel_8320.yaml</span></code>. This simulates an
instrument with no settable parameter; only an <code class="docutils literal"><span class="pre">*IDN?</span></code> response. This
is enough to instantiate the instrument.</p>
<p>Then we may connect to the simulated instrument.</p>
<div class="code ipython3 highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">qcodes.instrument.sims</span> <span class="k">as</span> <span class="nn">sims</span>
<span class="c1"># path to the .yaml file containing the simulated instrument</span>
<span class="n">visalib</span> <span class="o">=</span> <span class="n">sims</span><span class="o">.</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__init__.py&#39;</span><span class="p">,</span> <span class="s1">&#39;Weinschel_8320.yaml@sim&#39;</span><span class="p">)</span>

<span class="n">wein_sim</span> <span class="o">=</span> <span class="n">Weinschel_8320</span><span class="p">(</span><span class="s1">&#39;wein_sim&#39;</span><span class="p">,</span>
                          <span class="n">address</span><span class="o">=</span><span class="s1">&#39;GPIB::1::65535::INSTR&#39;</span><span class="p">,</span>  <span class="c1"># This matches the address in the .yaml file</span>
                          <span class="n">visalib</span><span class="o">=</span><span class="n">visalib</span>
                          <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Connected</span> <span class="n">to</span><span class="p">:</span> <span class="n">QCoDeS</span> <span class="n">Weinschel</span> <span class="mi">8320</span> <span class="p">(</span><span class="n">Simulation</span><span class="p">)</span> <span class="p">(</span><span class="n">serial</span><span class="p">:</span><span class="mi">1337</span><span class="p">,</span> <span class="n">firmware</span><span class="p">:</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">01</span><span class="p">)</span> <span class="ow">in</span> <span class="mf">0.07</span><span class="n">s</span>
</pre></div>
</div>
</div>
<div class="section" id="the-test">
<h3>The test<a class="headerlink" href="#the-test" title="Permalink to this headline">¶</a></h3>
<p>Now we can write a useful test!</p>
<div class="code ipython3 highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">qcodes.instrument_drivers.weinschel.Weinschel_8320</span> <span class="k">import</span> <span class="n">Weinschel_8320</span>
<span class="kn">import</span> <span class="nn">qcodes.instrument.sims</span> <span class="k">as</span> <span class="nn">sims</span>
<span class="n">visalib</span> <span class="o">=</span> <span class="n">sims</span><span class="o">.</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__init__.py&#39;</span><span class="p">,</span> <span class="s1">&#39;Weinschel_8320.yaml@sim&#39;</span><span class="p">)</span>


<span class="c1"># The following decorator makes the driver</span>
<span class="c1"># available to all the functions in this module</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">driver</span><span class="p">():</span>
    <span class="n">wein_sim</span> <span class="o">=</span> <span class="n">Weinschel_8320</span><span class="p">(</span><span class="s1">&#39;wein_sim&#39;</span><span class="p">,</span>
                              <span class="n">address</span><span class="o">=</span><span class="s1">&#39;GPIB::1::65535::INSTR&#39;</span><span class="p">,</span>
                              <span class="n">visalib</span><span class="o">=</span><span class="n">visalib</span>
                              <span class="p">)</span>
    <span class="k">yield</span> <span class="n">wein_sim</span>

    <span class="n">wein_sim</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_init</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test that simple initialisation works</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># There is not that much to do, really.</span>
    <span class="c1"># We can check that the IDN string reads back correctly</span>

    <span class="n">idn_dict</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">IDN</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">idn_dict</span><span class="p">[</span><span class="s1">&#39;vendor&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;QCoDeS&#39;</span>
</pre></div>
</div>
<p>Save the test as <code class="docutils literal"><span class="pre">qcodes/tests/drivers/test_weinschel_8320.py</span></code>.</p>
<p>Open a command line/console/terminal, navigate to the
<code class="docutils literal"><span class="pre">qcodes/tests/drivers/</span></code> folder and run</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">pytest</span> <span class="n">test_weinschel_8320</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This should give you an output similar to</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">=========================================</span> <span class="mi">1</span> <span class="n">passed</span> <span class="ow">in</span> <span class="mf">0.73</span> <span class="n">seconds</span> <span class="o">==========================================</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="congratulations-that-was-it">
<h2>Congratulations! That was it.<a class="headerlink" href="#congratulations-that-was-it" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="bonus-example-including-parameters-in-the-simulated-instrument">
<h2>Bonus example: including parameters in the simulated instrument<a class="headerlink" href="#bonus-example-including-parameters-in-the-simulated-instrument" title="Permalink to this headline">¶</a></h2>
<p>It is also possible to add queriable parameters to the <code class="docutils literal"><span class="pre">.yaml</span></code> file,
but testing that you can read those back is of limited value. You should
only add them if your driver needs them to instantiate, e.g. if it
checks that some range or impedance is configured correctly on startup,
or - more generally - if a part of your driver code that you’d like to
test needs it to run.</p>
<p>For the sake of this example, let us add a test that the driver’s
parameter’s validator will reject an attenuation of less than 0 dBm.
Note that this concrete test is redundant, since we have separate tests
for validators. It is, however, an excellent example to learn from.</p>
<p>First we update the <code class="docutils literal"><span class="pre">.yaml</span></code> file to contain a property matching the
parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">spec</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span>
<span class="n">devices</span><span class="p">:</span>
  <span class="n">device</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">eom</span><span class="p">:</span>
      <span class="n">GPIB</span> <span class="n">INSTR</span><span class="p">:</span>
        <span class="n">q</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span>  <span class="c1"># MAKE SURE! that this matches the terminator of the driver!</span>
        <span class="n">r</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">ERROR</span>
    <span class="n">dialogues</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">q</span><span class="p">:</span> <span class="s2">&quot;*IDN?&quot;</span>
        <span class="n">r</span><span class="p">:</span> <span class="s2">&quot;QCoDeS, Weinschel 8320 (Simulated), 1337, 0.0.01&quot;</span>

    <span class="n">properties</span><span class="p">:</span>

      <span class="n">attenuation</span><span class="p">:</span>
        <span class="n">default</span><span class="p">:</span> <span class="mi">0</span>
        <span class="n">getter</span><span class="p">:</span>
          <span class="n">q</span><span class="p">:</span> <span class="s2">&quot;ATTN? 1&quot;</span>  <span class="c1"># the set/get commands have to simply be copied over from the driver</span>
          <span class="n">r</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:02.0f}</span><span class="s2">&quot;</span>
        <span class="n">setter</span><span class="p">:</span>
          <span class="n">q</span><span class="p">:</span> <span class="s2">&quot;ATTN ALL </span><span class="si">{:02.0f}</span><span class="s2">&quot;</span>
          <span class="n">r</span><span class="p">:</span> <span class="n">OK</span>

<span class="n">resources</span><span class="p">:</span>
  <span class="n">GPIB</span><span class="p">::</span><span class="mi">1</span><span class="p">::</span><span class="n">INSTR</span><span class="p">:</span>
    <span class="n">device</span><span class="p">:</span> <span class="n">device</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Next we update the test script.</p>
<div class="code ipython3 highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">qcodes.instrument_drivers.weinschel.Weinschel_8320</span> <span class="k">import</span> <span class="n">Weinschel_8320</span>
<span class="kn">import</span> <span class="nn">qcodes.instrument.sims</span> <span class="k">as</span> <span class="nn">sims</span>
<span class="n">visalib</span> <span class="o">=</span> <span class="n">sims</span><span class="o">.</span><span class="vm">__file__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__init__.py&#39;</span><span class="p">,</span> <span class="s1">&#39;Weinschel_8320.yaml@sim&#39;</span><span class="p">)</span>


<span class="c1"># The following decorator makes the driver</span>
<span class="c1"># available to all the functions in this module</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">driver</span><span class="p">():</span>
    <span class="n">wein_sim</span> <span class="o">=</span> <span class="n">Weinschel_8320</span><span class="p">(</span><span class="s1">&#39;wein_sim&#39;</span><span class="p">,</span>
                              <span class="n">address</span><span class="o">=</span><span class="s1">&#39;GPIB::1::65535::INSTR&#39;</span><span class="p">,</span>
                              <span class="n">visalib</span><span class="o">=</span><span class="n">visalib</span>
                              <span class="p">)</span>
    <span class="k">yield</span> <span class="n">wein_sim</span>

    <span class="n">wein_sim</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_init</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test that simple initialisation works</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># There is not that much to do, really.</span>
    <span class="c1"># We can check that the IDN string reads back correctly</span>

    <span class="n">idn_dict</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">IDN</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">idn_dict</span><span class="p">[</span><span class="s1">&#39;vendor&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;QCoDeS&#39;</span>


<span class="k">def</span> <span class="nf">test_attenuation_validation</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test that incorrect values are rejected</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">bad_values</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">bv</span> <span class="ow">in</span> <span class="n">bad_values</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">attenuation</span><span class="p">(</span><span class="n">bv</span><span class="p">)</span>
</pre></div>
</div>
<p>Open a command line/console/terminal, navigate to the
<code class="docutils literal"><span class="pre">qcodes/tests/drivers/</span></code> folder and run</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">pytest</span> <span class="n">test_weinschel_8320</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This should give you an output similar to</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">=========================================</span> <span class="mi">2</span> <span class="n">passed</span> <span class="ow">in</span> <span class="mf">0.73</span> <span class="n">seconds</span> <span class="o">==========================================</span>
</pre></div>
</div>
</div>
<div class="section" id="that-s-it">
<h2>That’s it!<a class="headerlink" href="#that-s-it" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Datasaving examples.html" class="btn btn-neutral float-right" title="Datasaving Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Creating Instrument Drivers.html" class="btn btn-neutral" title="Creating QCoDeS instrument drivers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1.7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>