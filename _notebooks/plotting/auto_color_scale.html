

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Auto Color Scale &mdash; QCoDeS 0.1.11 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Example notebook for the Rigol DG 1062 instrument" href="../driver_examples/QCodes example Rigol DG1062.html" />
    <link rel="prev" title="Example Measurements with Real Instruments" href="../DataSet/Real_instruments/Example Measurements with Real Instruments.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> QCoDeS
          

          
          </a>

          
            
            
              <div class="version">
                0.1.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../help.html">Get Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataset/index.html">DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Classes and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/generated/qcodes.instrument_drivers.html">qcodes.instrument_drivers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Qcodes project plan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes/index.html">Changelogs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../examples/index.html">Examples of using QCoDeS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#basic-examples">Basic examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#dataset">DataSet</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../examples/index.html#plotting">Plotting</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Auto Color Scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tl-dr">TL;DR</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#table-of-contents">Table of contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#introduction-to-the-problem-and-risks">Introduction to the problem and risks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-the-automatic-color-scale">Using the automatic color scale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cuttoff-percentiles">Cuttoff Percentiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defaults-and-customizing-the-auto-color-scaling">Defaults and customizing the auto color scaling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-auto-color-scaling-in-custom-plotting">Using auto color scaling in custom plotting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#drivers">Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/index.html#benchmarking">Benchmarking</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QCoDeS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../examples/index.html">Examples of using QCoDeS</a> &raquo;</li>
        
      <li>Auto Color Scale</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/_notebooks/plotting/auto_color_scale.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="auto-color-scale">
<h1>Auto Color Scale<a class="headerlink" href="#auto-color-scale" title="Permalink to this headline">¶</a></h1>
<p>(back to overview
<a class="reference external" href="../main.ipynb">offline</a>,<a class="reference external" href="https://nbviewer.jupyter.org/github/QCoDeS/Qcodes/tree/master/docs/examples/main.ipynb">online</a>)</p>
<p><a class="reference external" href="https://nbviewer.jupyter.org/github/QCoDeS/Qcodes/tree/master/docs/examples/plotting/auto_color_scale.ipynb">read on
nbviewer</a></p>
</div>
<div class="section" id="tl-dr">
<h1>TL;DR<a class="headerlink" href="#tl-dr" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>use
<code class="docutils literal notranslate"><span class="pre">plot_by_id(run_id,</span> <span class="pre">auto_color_scale=True,</span> <span class="pre">cutoff_percentile=(0.5,</span> <span class="pre">0.6)</span></code>
to enable automatic color scaling</li>
<li>this maximally cuts 0.5% of the low valued data points and 0.6% of
the high valued data points.</li>
<li>You can also use it for <code class="docutils literal notranslate"><span class="pre">show_num</span></code> or for matplotlib with the
supplied auto scaling function.</li>
<li>Set your defaults in <code class="docutils literal notranslate"><span class="pre">qcodesrc.json</span></code>.</li>
</ul>
<div class="section" id="table-of-contents">
<h2>Table of contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><a class="reference external" href="#Introduction-to-the-problem-and-risks">Introduction to the problem and
risks</a></li>
<li><a class="reference external" href="#using">Using the automatic color scale</a><ol class="arabic">
<li><a class="reference external" href="#case1">Example 1: outliers in homogeneous data</a></li>
</ol>
</li>
<li><a class="reference external" href="#details">Details of the calculation</a></li>
<li><a class="reference external" href="#percentiles">Cutoff Percentiles</a><ol class="arabic">
<li><a class="reference external" href="#case2">Example 2: data on noisy background with outliers</a></li>
</ol>
</li>
<li><a class="reference external" href="#customizing">Defaults and customizing the auto color scaling</a></li>
<li><a class="reference external" href="#custom_plotting">Using auto color scaling in custom plotting</a></li>
</ol>
</div>
<div class="section" id="introduction-to-the-problem-and-risks">
<h2>Introduction to the problem and risks<a class="headerlink" href="#introduction-to-the-problem-and-risks" title="Permalink to this headline">¶</a></h2>
<p>It is a fairly common annoyance that a heat map plot of ones dearest
data does not show any of its details due to some outliers that push the
range of the color scale beyond the desired limits, as it is shown in
the image below: <img alt="image0" src="../../_images/auto_color_scale_swamped_small.png" /> Here there are two pixels (black and white)
corresponding to high and low outliers. The remaining data is uniformly
displayed as red and the actual structure of it is drowned. One can of
course specify the limits of the color bar manually to v iew the full
structure as shown here: <img alt="image1" src="../../_images/auto_color_scale_clean_small.png" /> But for a long measurement series this
becomes a time consuming task.</p>
<p>In this notebook an <em>automatic color scaling</em> is presented that tries to
empower the experimenter to circumvent this difficulty, while keeping
possible risks in mind.</p>
<p>The risk narrowing the color scale is clearly that the image
representing the data saturates in some regions and is no longer fully
representative of the actual data. Especially for automatic color
scaling this can become risky because without a theoretical model
describing the specific measurement one cannot scientifically argue for
the choice of the new limits of the color scale and possible meaningful
features might be disregarded.</p>
<p>For this reason automatic color scaling is deactivated by default and
has to be activated manually.</p>
</div>
<div class="section" id="using-the-automatic-color-scale">
<h2>Using the automatic color scale<a class="headerlink" href="#using-the-automatic-color-scale" title="Permalink to this headline">¶</a></h2>
<p>The following section presents an example of the usage of the automatic
color scaling with the new <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> and the <code class="docutils literal notranslate"><span class="pre">plot_by_id</span></code> function
for plotting. The same keywords will be implemented by <code class="docutils literal notranslate"><span class="pre">show_num</span></code> from
<code class="docutils literal notranslate"><span class="pre">qdev-wrappers</span></code>. Let’s first make the necessary imports:</p>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># store data in a separate db in order not to spam the actual measurement db</span>
<span class="kn">from</span> <span class="nn">qcodes</span> <span class="k">import</span> <span class="n">initialise_or_create_database_at</span><span class="p">,</span> <span class="n">new_data_set</span><span class="p">,</span> <span class="n">new_experiment</span>
<span class="kn">from</span> <span class="nn">qcodes.dataset.plotting</span> <span class="k">import</span> <span class="n">plot_by_id</span>
<span class="n">initialise_or_create_database_at</span><span class="p">(</span><span class="s1">&#39;../example.db&#39;</span><span class="p">)</span>

<span class="c1"># create an experiment for this tutorial</span>
<span class="n">new_experiment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tutorial_auto_color_scale&#39;</span><span class="p">,</span> <span class="n">sample_name</span><span class="o">=</span><span class="s2">&quot;outliers&quot;</span><span class="p">)</span>

<span class="c1"># import methods for creating datasets with outliers:</span>
<span class="kn">from</span> <span class="nn">qcodes.tests.test_plot_utils</span> <span class="k">import</span> <span class="p">(</span><span class="n">dataset_with_data_outside_iqr_high_outlier</span><span class="p">,</span>
                                          <span class="n">dataset_with_data_outside_iqr_low_outlier</span><span class="p">,</span>
                                          <span class="n">dataset_with_outliers</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="exampe-1-outliers-in-homogeneous-data">
<h3>Exampe 1: outliers in homogeneous data<a class="headerlink" href="#exampe-1-outliers-in-homogeneous-data" title="Permalink to this headline">¶</a></h3>
<p>Here we basically reproduce the images of the introduction, where we
have some smoothly structured data with some outliers that lie far
outside of the range of the remaining data:</p>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new dataset with outliers</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">dataset_with_outliers</span><span class="p">(</span><span class="n">new_data_set</span><span class="p">(</span><span class="s1">&#39;data_with_outliers&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>by plotting it simply by <code class="docutils literal notranslate"><span class="pre">plot_by_id</span></code> we get the full range</p>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/auto_color_scale_9_0.png" src="../../_images/auto_color_scale_9_0.png" />
<p>by adding the keyword <code class="docutils literal notranslate"><span class="pre">auto_color_scale=True</span></code> one activates the
scaling:</p>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/auto_color_scale_11_0.png" src="../../_images/auto_color_scale_11_0.png" />
<p>and the actual structure of the data becomes visible.</p>
<p>Please note two further details: - The triangles that appeared at the
top and the bottom of the color bar: These indicate that the color bar
does not cover the full range of the data spectrum. - The clipped
regions are marked with colors that are clearly not part of the color
scale in order to clearly separate those regions where we cannot make
any claim about any structure</p>
<p>## Details of the calculation</p>
<p>The new limits are calculated in three steps: - determine the inter
quartile range (IQR), i.e. the distance between the first (q1) and the
third (q3) quartile (see image below) - expand the region spanned by
[q1, q3] by 1.5 x the IQR. (Yet not beyond the original limits of the
min/max of the data) - limit the amount of data points clipped on each
side to an amount that is described by the lower (pl) and upper (pu)
cutoff percentiles. E.g. for pu=pl=0.5%, no more the white and gray
areas may not take up more than half a percent each of the total area.</p>
<p>to understand how this works lets consider the histogram of the previous
example:</p>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mappable</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span>
<span class="n">pl</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">pu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">97</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
<span class="c1"># IQR</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># cut off</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="c1"># limit through percentiles</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x7fb124a97198</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="../../_images/auto_color_scale_14_1.png" src="../../_images/auto_color_scale_14_1.png" />
<p>The black lines mark q1 and q3 and the blue lines correspond to the
interval widened by 1.5 x IQR. The red lines present the lines of the
percentile cutoff, in this case 3% on each side. The red lines limit how
much of the data may be cut away through the blue lines. In this
specific case of 3% they are not limiting the cutoff through the IQR
estimation. Please also note the barely filled bins at +-10, that
represent the outliers. The new color scale therefor roughly corresponds
to a threefold increase of the steepness of color gradient.</p>
</div>
</div>
<div class="section" id="cuttoff-percentiles">
<h2>Cuttoff Percentiles<a class="headerlink" href="#cuttoff-percentiles" title="Permalink to this headline">¶</a></h2>
<p>Limiting the effect of an automatic color scale by the cutoff
percentiles can be very important. To understand that consider the
following example:</p>
<div class="section" id="example-2-data-on-noisy-background-with-outliers">
<h3>Example 2: data on noisy background with outliers<a class="headerlink" href="#example-2-data-on-noisy-background-with-outliers" title="Permalink to this headline">¶</a></h3>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new dataset with outliers</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">dataset_with_data_outside_iqr_high_outlier</span><span class="p">(</span><span class="n">new_data_set</span><span class="p">(</span><span class="s1">&#39;data_outside_iqr&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/auto_color_scale_20_0.png" src="../../_images/auto_color_scale_20_0.png" />
<p>In this example dataset the region of interest shall be represented by
the center region. Again there are outliers that render the color
grading almost useless.</p>
<p>Looking at the same plot with an automatic color scale without limiting
cutoff percentiles (by setting the cutoff to 50% we basically deactivate
them) does not give a better result:</p>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cutoff_percentile</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/auto_color_scale_22_0.png" src="../../_images/auto_color_scale_22_0.png" />
<p>Here all the relevant region is considered as outliers. To make this
clearer let’s draw the histogram again:</p>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mappable</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span>
<span class="n">pl</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">pu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mf">99.5</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
<span class="c1"># IQR</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># cut off</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="c1"># limit through percentiles</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x7fb1247bb5c0</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="../../_images/auto_color_scale_24_1.png" src="../../_images/auto_color_scale_24_1.png" />
<p>The region of interest is represented by the right hand side structure
around 0. The IQR induced limits (blue) does not capture these values.
The percentile limits (0.5% here) however save the day:</p>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cutoff_percentile</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/auto_color_scale_26_0.png" src="../../_images/auto_color_scale_26_0.png" />
<p>There is some undesired clipping in the top right corner of the ROI but
the structure within the ROI is relatively well resolved.</p>
</div>
<div class="section" id="asymmetric-cutoffs">
<h3>Asymmetric cutoffs<a class="headerlink" href="#asymmetric-cutoffs" title="Permalink to this headline">¶</a></h3>
<p>Asymmetric cutoffs can be simply defined via a tuples. So for the data
of the first example we can disregard the lower outliers that take up up
to five percent of the data but not allow any clipping on the upper end:</p>
<div class="code ipython3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">dataset_with_outliers</span><span class="p">(</span><span class="n">new_data_set</span><span class="p">(</span><span class="s1">&#39;data_with_outliers&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cutoff_percentile</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">));</span>
</pre></div>
</div>
<img alt="../../_images/auto_color_scale_29_0.png" src="../../_images/auto_color_scale_29_0.png" />
</div>
</div>
<div class="section" id="defaults-and-customizing-the-auto-color-scaling">
<h2>Defaults and customizing the auto color scaling<a class="headerlink" href="#defaults-and-customizing-the-auto-color-scaling" title="Permalink to this headline">¶</a></h2>
<p>The defaults used by <code class="docutils literal notranslate"><span class="pre">plot_by_id</span></code> and <code class="docutils literal notranslate"><span class="pre">show_num</span></code> can be set in the
<code class="docutils literal notranslate"><span class="pre">qcodesrc.json</span></code> files. The system default is described in
<code class="docutils literal notranslate"><span class="pre">qcodes/config/qcodesrc.json</span></code>
(<a class="reference external" href="../../../qcodes/config/qcodesrc.json">offline</a>,<a class="reference external" href="https://github.com/QCoDeS/Qcodes/blob/master/qcodes/config/qcodesrc.json">online</a>)
To override the default edit these values in your custom
<code class="docutils literal notranslate"><span class="pre">qcodesrc.json</span></code> file in your home directory.</p>
<p>The defaults are (for detailed description see the schema file)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;auto_color_scale&quot;</span><span class="p">:{</span>
    <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;cutoff_percentile&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
    <span class="s2">&quot;color_over&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="s2">&quot;color_under&quot;</span><span class="p">:</span> <span class="s2">&quot;grey&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Because of the possible risks due to auto color scaling it is
deactivated by default. Please remember to change the colors marking the
outliers in case you should use a color map the includes white and gray.</p>
</div>
<div class="section" id="using-auto-color-scaling-in-custom-plotting">
<h2>Using auto color scaling in custom plotting<a class="headerlink" href="#using-auto-color-scaling-in-custom-plotting" title="Permalink to this headline">¶</a></h2>
<p>If you are using matplotlib but do not want to rely on <code class="docutils literal notranslate"><span class="pre">plot_by_id</span></code> or
<code class="docutils literal notranslate"><span class="pre">show_num</span></code> you can simply call:
<code class="docutils literal notranslate"><span class="pre">qcodes.utils.plotting.apply_auto_color_scale(colorbar,</span> <span class="pre">...)</span></code> and
provide any matplotlib color bar to achieve the described effects.</p>
<p>If you want to use the qcodes config system for defaults call
<code class="docutils literal notranslate"><span class="pre">qcodes.utils.plotting.auto_color_scale_from_config(colorbar,...)</span></code>
instead.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../driver_examples/QCodes example Rigol DG1062.html" class="btn btn-neutral float-right" title="Example notebook for the Rigol DG 1062 instrument" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../DataSet/Real_instruments/Example Measurements with Real Instruments.html" class="btn btn-neutral" title="Example Measurements with Real Instruments" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'0.1.11',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>