
Datasaving Examples
===================

.. code:: ipython3

    %matplotlib nbagg
    import numpy as np
    from importlib import reload
    import qcodes as qc

.. code:: ipython3

    import sys
    import logging
    # Create logger
    logger = logging.getLogger()
    logger.setLevel(logging.DEBUG)
    
    # Create STDERR handler
    handler = logging.StreamHandler(sys.stderr)
    # ch.setLevel(logging.DEBUG)
    
    # Create formatter and add it to the handler
    formatter = logging.Formatter('%(name)s - %(levelname)s - %(message)s')
    handler.setFormatter(formatter)
    
    # Set STDERR handler as the only handler 
    logger.handlers = [handler]

.. code:: ipython3

    from qcodes.data import hdf5_format
    reload(hdf5_format)
    h5fmt = hdf5_format.HDF5Format()

Start a loop and generate data from dummy instruments
-----------------------------------------------------

.. code:: ipython3

    station = qc.station.Station()

.. code:: ipython3

    from qcodes.tests.instrument_mocks import MockParabola
    station.add_component(MockParabola(name='MockParabola', server_name=None))


.. parsed-literal::

    root - WARNING - Error getting or interpreting *IDN?: ''




.. parsed-literal::

    'MockParabola'



.. code:: ipython3

    loop = qc.Loop(station.MockParabola.x[-100:100:20]).each(station.MockParabola.skewed_parabola)
    data_l = loop.run(name='MockParabola_run', formatter=qc.data.gnuplot_format.GNUPlotFormat())
    



.. parsed-literal::

    DataSet:
       location = 'data/2017-03-10/#017_MockParabola_run_15-44-02'
       <Type>   | <array_id>                   | <array.name>    | <array.shape>
       Setpoint | MockParabola_x_set           | x               | (10,)
       Measured | MockParabola_skewed_parabola | skewed_parabola | (10,)
    started at 2017-03-10 15:44:02


.. code:: ipython3

    reload(hdf5_format)
    h5fmt = hdf5_format.HDF5Format()
    loop = qc.Loop(station.MockParabola.x[-100:100:20]).loop(
        station.MockParabola.y[-100:50:10]).each(station.MockParabola.skewed_parabola)
    data_l = loop.run(name='MockParabola_run', formatter=h5fmt)



.. parsed-literal::

    DataSet:
       location = 'data/2017-03-10/#018_MockParabola_run_15-44-07'
       <Type>   | <array_id>                   | <array.name>    | <array.shape>
       Setpoint | MockParabola_x_set           | x               | (10,)
       Setpoint | MockParabola_y_set           | y               | (10, 15)
       Measured | MockParabola_skewed_parabola | skewed_parabola | (10, 15)
    started at 2017-03-10 15:44:07


.. code:: ipython3

    from importlib import reload
    from qcodes.data import hdf5_format
    reload(hdf5_format)
    h5fmt = hdf5_format.HDF5Format()
    data2 = qc.data.data_set.DataSet(location=data_l.location, formatter=h5fmt)
    data2.read()

Run the tests for the dataformat
--------------------------------

.. code:: ipython3

    from qcodes.utils import helpers
    reload(helpers)
    reload(hdf5_format)
    import unittest
    h5fmt = hdf5_format.HDF5Format()
    import qcodes.tests.test_hdf5formatter as tf
    reload(tf)
    tst = tf.TestHDF5_Format
    suite = unittest.defaultTestLoader.loadTestsFromTestCase(tst)
    result = unittest.TextTestRunner(verbosity=2).run(suite)



.. parsed-literal::

    test_closed_file (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... root - WARNING - Cannot close file, data_set has no open hdf5 file
    root - WARNING - Cannot close file, data_set has no open hdf5 file
    ok
    test_dataset_closing (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_dataset_finalize_closes_file (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_dataset_flush_after_write (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_dataset_with_missing_attrs (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_double_closing_gives_warning (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_full_write_read_1D (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_full_write_read_2D (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_incremental_write (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_loop_writing (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... root - WARNING - Error getting or interpreting *IDN?: ''
    ok
    test_loop_writing_2D (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... root - WARNING - Error getting or interpreting *IDN?: ''
    ok
    test_metadata_write_read (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_read_writing_dicts_withlists_to_hdf5 (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_reading_into_existing_data_array (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_str_to_bool (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_writing_metadata (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... ok
    test_writing_unsupported_types_to_hdf5 (qcodes.tests.test_hdf5formatter.TestHDF5_Format) ... root - WARNING - List of type "<class 'qcodes.data.data_set.DataSet'>" for "list_of_dataset":"[DataSet:
       location = '/Users/unga/src/Qcodes/qcodes/unittest_data/2017-03-10/#016_test_missing_attr_15-44-09'
       <Type> | <array_id> | <array.name> | <array.shape>, DataSet:
       location = '/Users/unga/src/Qcodes/qcodes/unittest_data/2017-03-10/#016_test_missing_attr_15-44-09'
       <Type> | <array_id> | <array.name> | <array.shape>]" not supported, storing as string
    root - WARNING - Type "<class 'qcodes.data.data_set.DataSet'>" for "nested_dataset":"DataSet:
       location = '/Users/unga/src/Qcodes/qcodes/unittest_data/2017-03-10/#016_test_missing_attr_15-44-09'
       <Type> | <array_id> | <array.name> | <array.shape>" not supported, storing as string
    root - WARNING - List of mixed type for "<class 'list'>":"list_of_mixed_type" not supported, storing as string


.. parsed-literal::

    DataSet:
       location = '/Users/unga/src/Qcodes/qcodes/unittest_data/2017-03-10/#010_MockLoop_hdf5_test_15-44-09'
       <Type>   | <array_id>                        | <array.name>    | <array.shape>
       Setpoint | Loop_writing_test_x_set           | x               | (10,)
       Measured | Loop_writing_test_skewed_parabola | skewed_parabola | (10,)
    started at 2017-03-10 15:44:09
    DataSet:
       location = '/Users/unga/src/Qcodes/qcodes/unittest_data/2017-03-10/#011_MockLoop_hdf5_test_15-44-09'
       <Type>   | <array_id>                           | <array.name>    | <array.shape>
       Setpoint | Loop_writing_test_2D_x_set           | x               | (10,)
       Setpoint | Loop_writing_test_2D_y_set           | y               | (10, 10)
       Measured | Loop_writing_test_2D_skewed_parabola | skewed_parabola | (10, 10)
    started at 2017-03-10 15:44:09


.. parsed-literal::

    ok
    
    ----------------------------------------------------------------------
    Ran 17 tests in 0.348s
    
    OK

