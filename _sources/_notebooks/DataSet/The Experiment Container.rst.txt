
The Experiment Container
========================

This notebook explains how the database works as an experiment
container.

.. code:: ipython3

    import qcodes as qc
    from qcodes.dataset.database import initialise_database

The database
------------

The database on file is selected via the QCoDeS configuration file and a
connection to it is set up at import time. There is always only one
database selected as the "active" one.

The config file
~~~~~~~~~~~~~~~

We'll be modifying the config file in a second, so first a brief word
about the config system.

Only one config file can be used at a time. The default config file
should not be overwritten, so if you have any modifications, you should
save the updated config file on your home directory **OR** in the
current working directory of your script/notebook. The QCoDeS config
system first looks in the current directory for a config file and then
in the home directory for one and only then - if no config files where
found - does it fall back to using the default one. The default config
is located in ``qcodes/qcodes/config``.

.. code:: ipython3

    # To inspect the config file, use
    configuration = qc.config
    print(f'Using config file from {configuration.current_config_path}')
    print(f'Database location: {configuration["core"]["db_location"]}')


.. parsed-literal::

    Using config file from /home/travis/qcodesrc.json
    Database location: ./exp_container_tutorial.db


Note that the default setting for the database location is a relative
path. That is a sane default setting, but not always what you want. If
you execute scripts from many different folders on your machine, you
should change the default location to an absolute path pointing to your
data folder, or you will end up with multiple databases.

.. code:: ipython3

    # Changing the settings can done like so:
    
    configuration['core']['db_location'] = '~/my/particular/absolute/path/database.db'
    
    # To keep the changes after a kernel restart, save them to disk
    # configuration.save_to_home()  # this saves to the configuration file to the home directory

For the sake of pedagogical clarity, we now create a new empty default
database.

.. code:: ipython3

    # point the config system to the new location
    configuration['core']['db_location'] = './exp_container_tutorial.db'
    # now save the config file in home. 
    # NOTE: This config file will 
    # from now on loaded by qcodes instead of the default.
    configuration.save_to_home()
    # create an empty database based on the config file
    initialise_database()

The experiments inside the database
-----------------------------------

The database holds a certain number of **experiments**. They may be
viewed:

.. code:: ipython3

    qc.dataset.experiment_container.experiments()




.. parsed-literal::

    [tutorial_exp#no sample#1@./exp_container_tutorial.db
     ----------------------------------------------------
     1-results-1-dac_ch1,dmm_v1-10
     2-results-2-dac_ch1,dmm_v1-33
     3-results-3-dac_ch1,dmm_v1-100
     4-results-4-dac_ch1,dac_ch2,dmm_v1-40000
     5-results-5-dac_ch1,dac_ch2,dmm_v1-44100
     6-results-6-dac_ch1,dac_ch2,dmm_v1-20368
     7-results-7-dac_ch1,dac_ch2,dmm_v1-5000
     8-results-8-dac_ch1,dac_ch2,dmm_v1-77
     9-results-9-dac_ch1,dmm_v1-10
     10-results-10-dac_ch1,dmm_v1-10
     11-results-11-MyDummy_ChanA_this_setpoint,MyDummy_ChanA_that_setpoint,this,that-15,
     old_data_loading#no_sample#2@./exp_container_tutorial.db
     --------------------------------------------------------
     12-results-1-ch1,voltage-201
     13-results-2-ch1,ch2,voltage-36]



Not surprisingly, our new database is empty. Let us add some
experiments.

.. code:: ipython3

    qc.dataset.experiment_container.new_experiment('first_exp', sample_name='old_sample')
    qc.dataset.experiment_container.new_experiment('second_exp', sample_name='slightly_newer_sample')
    qc.dataset.experiment_container.new_experiment('second_exp', sample_name='brand_new_sample')




.. parsed-literal::

    second_exp#brand_new_sample#5@./exp_container_tutorial.db
    ---------------------------------------------------------



.. code:: ipython3

    qc.dataset.experiment_container.experiments()




.. parsed-literal::

    [tutorial_exp#no sample#1@./exp_container_tutorial.db
     ----------------------------------------------------
     1-results-1-dac_ch1,dmm_v1-10
     2-results-2-dac_ch1,dmm_v1-33
     3-results-3-dac_ch1,dmm_v1-100
     4-results-4-dac_ch1,dac_ch2,dmm_v1-40000
     5-results-5-dac_ch1,dac_ch2,dmm_v1-44100
     6-results-6-dac_ch1,dac_ch2,dmm_v1-20368
     7-results-7-dac_ch1,dac_ch2,dmm_v1-5000
     8-results-8-dac_ch1,dac_ch2,dmm_v1-77
     9-results-9-dac_ch1,dmm_v1-10
     10-results-10-dac_ch1,dmm_v1-10
     11-results-11-MyDummy_ChanA_this_setpoint,MyDummy_ChanA_that_setpoint,this,that-15,
     old_data_loading#no_sample#2@./exp_container_tutorial.db
     --------------------------------------------------------
     12-results-1-ch1,voltage-201
     13-results-2-ch1,ch2,voltage-36,
     first_exp#old_sample#3@./exp_container_tutorial.db
     --------------------------------------------------,
     second_exp#slightly_newer_sample#4@./exp_container_tutorial.db
     --------------------------------------------------------------,
     second_exp#brand_new_sample#5@./exp_container_tutorial.db
     ---------------------------------------------------------]



We notice that each experiment is labelled by an integer. This is the
**exp\_id** that can be used when looking up properties of each
experiment.

Let us add some runs to experiment 2 ("second\_exp"). For the sake of
clarity, we don't add any data to the runs here. We refer to the
``Dataset Context Manager.ipynb`` for detailed information on how to
properly create and populate runs.

.. code:: ipython3

    qc.dataset.data_set.new_data_set('a_good_run', exp_id=2)




.. parsed-literal::

    a_good_run #14@./exp_container_tutorial.db
    ------------------------------------------



.. code:: ipython3

    qc.dataset.data_set.new_data_set('a_nother_run', exp_id=2)




.. parsed-literal::

    a_nother_run #15@./exp_container_tutorial.db
    --------------------------------------------



We may now inspect experiment 2.

.. code:: ipython3

    exp_2 = qc.dataset.experiment_container.load_experiment(2)

.. code:: ipython3

    # Printing the experiment will reveal the runs
    
    print(exp_2)


.. parsed-literal::

    old_data_loading#no_sample#2@./exp_container_tutorial.db
    --------------------------------------------------------
    12-results-1-ch1,voltage-201
    13-results-2-ch1,ch2,voltage-36
    14-a_good_run-3-None-0
    15-a_nother_run-4-None-0


In a similar way, we may of course add runs to the other two
experiments. Now, the alert reader will have noticed that ``exp_id`` is
a keyword argument in ``new_data_set``. What is the default then? --The
default is that the run is added to the experiment with the **highest**
``exp_id`` in the database.
