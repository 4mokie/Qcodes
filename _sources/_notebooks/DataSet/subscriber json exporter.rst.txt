
Subscriber with JSON export
===========================

.. code:: ipython3

    import logging
    import copy
    logging.basicConfig(level="INFO")
    from qcodes import Publisher
    import numpy as np
    import json

.. code:: ipython3

    from qcodes.dataset.data_set import new_data_set, ParamSpec
    from qcodes.dataset.json_exporter import json_template_heatmap, json_template_linear
    from qcodes.dataset.json_exporter import export_data_as_json_heatmap, export_data_as_json_linear
    from qcodes.dataset.sqlite_base import new_experiment, connect, length

.. code:: ipython3

    dataSet = new_data_set("test", specs=[ParamSpec("x", "numeric"), ParamSpec("y", "numeric")])

.. code:: ipython3

    mystate = {}
    mystate['json'] = copy.deepcopy(json_template_linear)
    mystate['json']['x']['name'] = 'xname'
    mystate['json']['x']['unit'] = 'xunit'
    mystate['json']['x']['full_name'] = 'xfullname'
    mystate['json']['y']['name'] = 'yname'
    mystate['json']['y']['unit'] = 'yunit'
    mystate['json']['y']['full_name'] = 'yfullname'

.. code:: ipython3

    sub_id = dataSet.subscribe(export_data_as_json_linear, min_wait=0, min_count=20,
                               state=mystate, callback_kwargs={'location': 'foo'})

.. code:: ipython3

    s = dataSet.subscribers[sub_id]

.. code:: ipython3

    mystate




.. parsed-literal::

    {'json': {'type': 'linear',
      'x': {'data': [],
       'name': 'xname',
       'full_name': 'xfullname',
       'is_setpoint': True,
       'unit': 'xunit'},
      'y': {'data': [],
       'name': 'yname',
       'full_name': 'yfullname',
       'is_setpoint': False,
       'unit': 'yunit'}}}



.. code:: ipython3

    for x in range(100):
        y = x
        dataSet.add_result({"x":x, "y":y})
    dataSet.mark_complete()

.. code:: ipython3

    mystate




.. parsed-literal::

    {'json': {'type': 'linear',
      'x': {'data': [0,
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24,
        25,
        26,
        27,
        28,
        29,
        30,
        31,
        32,
        33,
        34,
        35,
        36,
        37,
        38,
        39,
        40,
        41,
        42,
        43,
        44,
        45,
        46,
        47,
        48,
        49,
        50,
        51,
        52,
        53,
        54,
        55,
        56,
        57,
        58,
        59,
        60,
        61,
        62,
        63,
        64,
        65,
        66,
        67,
        68,
        69,
        70,
        71,
        72,
        73,
        74,
        75,
        76,
        77,
        78,
        79,
        80,
        81,
        82,
        83,
        84,
        85,
        86,
        87,
        88,
        89,
        90,
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        98,
        99],
       'name': 'xname',
       'full_name': 'xfullname',
       'is_setpoint': True,
       'unit': 'xunit'},
      'y': {'data': [0,
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13,
        14,
        15,
        16,
        17,
        18,
        19,
        20,
        21,
        22,
        23,
        24,
        25,
        26,
        27,
        28,
        29,
        30,
        31,
        32,
        33,
        34,
        35,
        36,
        37,
        38,
        39,
        40,
        41,
        42,
        43,
        44,
        45,
        46,
        47,
        48,
        49,
        50,
        51,
        52,
        53,
        54,
        55,
        56,
        57,
        58,
        59,
        60,
        61,
        62,
        63,
        64,
        65,
        66,
        67,
        68,
        69,
        70,
        71,
        72,
        73,
        74,
        75,
        76,
        77,
        78,
        79,
        80,
        81,
        82,
        83,
        84,
        85,
        86,
        87,
        88,
        89,
        90,
        91,
        92,
        93,
        94,
        95,
        96,
        97,
        98,
        99],
       'name': 'yname',
       'full_name': 'yfullname',
       'is_setpoint': False,
       'unit': 'yunit'}}}



.. code:: ipython3

    mystate = {}
    xlen = 5
    ylen = 10
    mystate['json'] = json_template_heatmap.copy()
    mystate['data'] = {}
    mystate['data']['xlen'] = xlen
    mystate['data']['ylen'] = ylen
    mystate['data']['x'] = np.zeros((xlen*ylen), dtype=np.object)
    mystate['data']['x'][:] = None
    mystate['data']['y'] = np.zeros((xlen*ylen), dtype=np.object)
    mystate['data']['y'][:] = None
    mystate['data']['z'] = np.zeros((xlen*ylen), dtype=np.object)
    mystate['data']['z'][:] = None
    mystate['data']['location'] = 0

.. code:: ipython3

    dataSet_hm = new_data_set("test", specs=[ParamSpec("x", "numeric"),
                                             ParamSpec("y", "numeric"),
                                             ParamSpec("z", "numeric")])

.. code:: ipython3

    sub_id = dataSet_hm.subscribe(export_data_as_json_heatmap, min_wait=0, min_count=20,
                                  state=mystate, callback_kwargs={'location': './foo'})

.. code:: ipython3

    for x in range(xlen):
        for y in range(ylen):
            z = x+y
            dataSet_hm.add_result({"x":x, "y":y, 'z':z})
    dataSet_hm.mark_complete()

.. code:: ipython3

    mystate['json']




.. parsed-literal::

    {'type': 'heatmap',
     'x': {'data': [0, 1, 2, 3, 4],
      'name': '',
      'full_name': '',
      'is_setpoint': True,
      'unit': ''},
     'y': {'data': [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
      'name': '',
      'full_name': '',
      'is_setpoint': True,
      'unit': ''},
     'z': {'data': [[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
       [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
       [2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
       [3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
       [4, 5, 6, 7, 8, 9, 10, 11, 12, 13]],
      'name': '',
      'full_name': '',
      'is_setpoint': False,
      'unit': ''}}


